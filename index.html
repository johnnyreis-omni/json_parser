<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Omnisend Personalization Path Builder</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <header>
    <h1 id="app-title">Omnisend Personalization Path Builder</h1>
    <span class="tag" aria-hidden="true">[[ … ]]</span>
    <div class="header-actions" role="group" aria-label="Display options">
      <button id="contrastBtn" type="button" class="secondary" aria-pressed="false" aria-label="Toggle high-contrast mode">High contrast</button>
    </div>
  </header>

  <main id="main" class="wrap">
    <section class="card area-howto" aria-labelledby="howto-title">
      <h2 id="howto-title">How to use</h2>
      <div class="body">
        <ol class="steps" aria-label="Step-by-step instructions">
          <li>Paste your event JSON under “Paste JSON”. Press JSON Breakdown or use Ctrl/⌘+Enter.</li>
          <li>In “Pick a field”, browse the Tree and click a key to select it. Use → to expand, ← to collapse, ↑/↓ to move, Enter/Space to toggle.</li>
          <li>Use Quick search to jump directly to fields.</li>
          <li>Choose a tag prefix and optional fallback. The Omnisend tag updates instantly.</li>
          <li>Copy the Dot/Bracket path, Omnisend tag, Dynamic alias, or Preview value.</li>
        </ol>
        <div class="tips">
          <p class="note">Shopify-style payloads often store properties under <code>raw</code> (for example <code>event.raw.shipping_address.city</code>).</p>
          <p class="note">Arrays like <code>line_items</code> can be indexed (for example <code>[0]</code>) or iterated in Dynamic Content with <code>[[ item... ]]</code>.</p>
        </div>
      </div>
    </section>

    <section class="card area-left" aria-labelledby="paste-json-title">
      <h2 id="paste-json-title">1) Paste JSON</h2>
      <div class="body">
        <label for="jsonInput" class="visually-hidden" style="position:absolute;left:-9999px;">Event JSON input</label>
        <textarea id="jsonInput" placeholder='Paste your event JSON here (e.g., {"raw":{...}})' aria-describedby="json-help" spellcheck="false"></textarea>
        <div class="controls">
          <button id="parseBtn" type="button" class="primary">JSON Breakdown</button>
          <button id="clearBtn" type="button" class="secondary" title="Clear input and tree">Clear</button>
          <select id="prefixSelect" title="Which variable to prefix in the tag" aria-label="Tag prefix">
            <option value="event" selected>Tag prefix: event</option>
            <option value="">Tag prefix: (none)</option>
          </select>
          <input id="fallbackInput" type="text" placeholder="Optional fallback, e.g. there" title="Adds | default: 'value'" aria-label="Optional fallback value"/>
        </div>
        <p id="json-help" class="note">Tip: For Shopify/standard events, data often lives under <code>raw</code> (e.g., <code>event.raw.shipping_address.city</code>). Lists like <code>line_items</code> can be indexed (<code>[0]</code>) or used with a Dynamic Layout (<code>[[ item.title ]]</code>).</p>
        <p id="live-status" class="status" aria-live="polite"></p>
        <p id="copy-status" class="status" aria-live="assertive"></p>
      </div>
    </section>

    <section class="card area-right" aria-labelledby="pick-field-title">
      <h2 id="pick-field-title">2) Pick a field → get the tag</h2>
      <div class="body body-split">
        <div class="side">
          <label for="searchBox">Quick search</label>
          <div class="search">
            <input id="searchBox" type="search" placeholder="Search keys (e.g., line_items, email, city)" aria-controls="results" />
            <button id="expandAll" class="copy" type="button" title="Expand all nodes">Expand all</button>
          </div>
          <div id="results" class="results" aria-live="polite" role="listbox" aria-label="Search results"></div>
        </div>
        <div class="main">
          <label for="tree">Tree</label>
          <div id="tree" class="tree" role="tree" aria-label="JSON tree"></div>
        </div>
      </div>

      <div class="body">
        <div id="out" class="out" style="display:none;">
          <div>
            <div class="title">Selected node</div>
            <div id="selMeta" class="status" aria-live="polite"></div>
          </div>
          <div>
            <div class="title">Dot/Bracket path</div>
            <div class="line" id="dotPath" role="textbox" aria-readonly="true"></div>
            <button class="copy" data-copy="dotPath" type="button" aria-label="Copy dot or bracket path">Copy path</button>
          </div>
          <div>
            <div class="title">Omnisend tag</div>
            <div class="line" id="tag" role="textbox" aria-readonly="true"></div>
            <button class="copy" data-copy="tag" type="button" aria-label="Copy Omnisend tag">Copy tag</button>
          </div>
          <div id="dynBox" style="display:none;">
            <div class="title">Dynamic Layout suggestion (list alias)</div>
            <div class="line" id="dynTag" role="textbox" aria-readonly="true"></div>
            <button class="copy" data-copy="dynTag" type="button" aria-label="Copy alias tag">Copy alias tag</button>
            <div class="note">Use this inside a Dynamic Content layout whose data source is the list (e.g., <code>Raw → line_items</code>), where each item is aliased as <code>item</code>.</div>
          </div>
          <div>
            <div class="title">Preview value</div>
            <div class="line" id="preview" role="textbox" aria-readonly="true"></div>
            <button class="copy" data-copy="preview" type="button" aria-label="Copy preview value">Copy value</button>
          </div>
        </div>
      </div>

      <div class="footer-note">
        Heads-up: Omnisend personalization uses double square brackets (e.g., <code>[[ contact.first_name ]]</code>), supports Liquid filters like <code>| default:</code> and <code>| capitalize</code>, and event properties (often under <code>raw</code>) in Automations. Lists can be iterated in Dynamic Content. See <a href="https://support.omnisend.com/en/articles/1061845-personalization-in-channels">Omnisend’s docs</a> for details.
      </div>
    </section>
  </main>

  <footer class="footer-note" role="contentinfo">
    <small>Keyboard: ↑ ↓ to move · → to expand/select · ← to collapse · Enter/Space to toggle · Home/End to jump.</small>
  </footer>

<script src="scripts.js"></script>
</body>
</html>
